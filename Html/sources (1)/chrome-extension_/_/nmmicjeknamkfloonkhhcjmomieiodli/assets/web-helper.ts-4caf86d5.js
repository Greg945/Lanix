import{a as k,g as M,S as j}from"./createLucideIcon-6676f207.js";import{u as O,X,U as E,c as L,d as N}from"./check-user-limit-4030da23.js";import{r as l,j as o,R as C}from"./jsx-runtime-4286988b.js";import{d as b,s as v,D as U,n as Y,o as B,p as H}from"./get-current-media-197cd4a9.js";import"./browser-polyfill-45feeee0.js";import{c as F,W as K}from"./firebase-997f25e3.js";import{u as $}from"./use-form-a922f050.js";import{g as S}from"./get-user-config-c40076a6.js";import"./index-cd77e154.js";const d=42,P=({forceShow:e=!1})=>{const[i,a]=O(!1),{userConfig:s}=$(),[u,h]=l.useState(!0),[r,m]=l.useState(!1),[t,w]=l.useState(null),[c,z]=l.useState(!1),p=l.useRef({startX:0,startY:0,startTime:0,initialMouseX:0,initialMouseY:0});l.useEffect(()=>{const n=()=>{t===null&&w({x:window.innerWidth-60,y:window.innerHeight-60})};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[t]);const f=l.useCallback(n=>{if(c){const y=Math.max(0,Math.min(window.innerWidth-d,n.pageX-p.current.startX)),x=Math.max(0,Math.min(window.innerHeight-d,n.pageY-p.current.startY));w({x:y,y:x})}},[c]),g=l.useCallback(()=>{z(!1)},[]);l.useEffect(()=>{if(c)return document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g)}},[c,f,g]);const _=async n=>{const y=Date.now()-p.current.startTime,x=Math.sqrt(Math.pow(n.pageX-p.current.initialMouseX,2)+Math.pow(n.pageY-p.current.initialMouseY,2));if(y<1500&&x<30){const R=b(),W=await S();await v({media:R,userConfig:W})}},D=n=>{z(!0),p.current={startX:n.pageX-((t==null?void 0:t.x)||0),startY:n.pageY-((t==null?void 0:t.y)||0),startTime:Date.now(),initialMouseX:n.pageX,initialMouseY:n.pageY},n.preventDefault()},T=n=>{n.stopPropagation(),h(!1)},A=()=>{c||(m(!0),a.on())},I=()=>{m(!1),a.off()};return t===null||!u||s.summaryIconVisibility==="hidden"&&!e?null:o.jsx("div",{className:`fixed ${u?"block":"hidden"}`,style:{width:d,height:d,left:`${t.x}px`,top:`${t.y}px`,cursor:c?"grabbing":"pointer",zIndex:9999},children:o.jsxs("div",{className:`flex justify-center items-center w-[42px] h-[42px] p-1 rounded-full border border-gray-200 shadow-sm bg-white relative hover:bg-gray-50 ${c?"cursor-grabbing":"cursor-pointer"}`,style:{width:d,height:d},onClick:_,onMouseDown:D,onMouseEnter:A,onMouseLeave:I,children:[o.jsx("div",{className:`absolute -top-2 -right-2 w-5 h-5 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center hover:bg-gray-200 cursor-pointer z-10 transition-opacity duration-500 ${r?"opacity-100":"opacity-0"}`,onClick:T,style:{pointerEvents:r?"auto":"none"},children:o.jsx(X,{size:12,className:"text-gray-500"})}),o.jsx(F,{size:24}),i&&!c&&o.jsx("div",{className:"absolute top-0 left-auto grid items-center justify-center",style:{height:d,right:d},children:o.jsx("span",{className:"text-[11px] leading-tight !text-white text-center whitespace-nowrap w-fit px-2 py-1.5 bg-black opacity-90 rounded-md",children:"Summarize Page"})})]})})},V=()=>{const e=k();e.style.position="fixed",e.style.bottom="16px",e.style.right="16px",e.style.zIndex="9999",document.body.insertAdjacentElement("afterend",e),M.createRoot(e).render(o.jsx(C.StrictMode,{children:o.jsx(E,{children:o.jsx(L,{children:o.jsx(j,{children:o.jsx(P,{})})})})}))},q=["www.youtube.com"],G=()=>q.includes(window.location.hostname)?!1:J()||Q(),J=()=>{var e,i,a;try{const s=window.opener!==null,u=window.innerWidth<600&&window.innerHeight<600,h=((e=window==null?void 0:window.locationbar)==null?void 0:e.visible)===!1||((i=window==null?void 0:window.menubar)==null?void 0:i.visible)===!1||((a=window==null?void 0:window.toolbar)==null?void 0:a.visible)===!1;return s&&(u||h)}catch{return!1}},Q=()=>{const e=[/accounts\.google\.com\/o\/oauth2/,/accounts\.google\.com/,/oauth2\.googleapis\.com/,/appleid\.apple\.com\/auth/,/appleid\.apple\.com\/signin/,/appleid\.apple\.com\/authorize/,/appleid\.apple\.com\/oauth/,/login\.microsoftonline\.com/,/login\.live\.com\/oauth/,/azure\.com\/oauth2/,/github\.com\/login\/oauth/,/api\.github\.com\/login\/oauth/,/facebook\.com\/dialog\/oauth/,/facebook\.com\/v[\d.]+\/dialog\/oauth/,/linkedin\.com\/oauth/,/api\.linkedin\.com\/v[\d.]+\/oauth/,/twitter\.com\/oauth/,/api\.twitter\.com\/oauth/,/accounts\.slack\.com\/oauth/,/slack\.com\/oauth\/authorize/,/discord\.com\/api\/oauth2/,/discord\.com\/oauth2\/authorize/,/reddit\.com\/api\/v1\/authorize/,/twitch\.tv\/oauth2/,/id\.twitch\.tv\/oauth2/,/pinterest\.com\/oauth/,/api\.pinterest\.com\/oauth/,/okta\.com\/oauth2/,/\.okta\.com\/oauth2\/authorize/,/auth0\.com\/authorize/,/\.auth0\.com\/oauth\/token/,/login\.salesforce\.com\/services\/oauth2/,/amazonaws\.com\/oauth2/,/cognito-idp\./,/zoom\.us\/oauth/,/marketplace\.zoom\.us\/oauth/,/dropbox\.com\/oauth2/,/api\.dropbox\.com\/oauth2/,/box\.com\/api\/oauth2/,/api\.box\.com\/oauth2/,/spotify\.com\/api\/oauth/,/accounts\.spotify\.com\/authorize/,/oauth2?\/?authorize/i,/oauth2?\/?authenticate/i,/oauth2?\/?token/i],i=["oauth","authorize","authentication","sso","saml","login","signin","consent","permission"],a=["code","token","access_token","id_token","state","scope","client_id","response_type","redirect_uri","grant_type","authorization","nonce","prompt","response_mode"],s=window.location.href.toLowerCase(),u=new URLSearchParams(window.location.search),h=window.location.pathname.toLowerCase(),r=window.location.hash.toLowerCase();if(e.some(t=>t.test(s))||a.some(t=>u.has(t))||r&&a.some(t=>r.includes(t))||i.some(t=>s.includes(t)||h.includes(t)))return!0;try{const t=new URLSearchParams(r.replace("#",""));if(t.has("access_token")||t.has("id_token"))return!0}catch{}if(u.has("error")&&u.has("error_description"))return!0;const m=document.getElementsByTagName("meta");for(const t of m){const w=(t.content||"").toLowerCase();if(i.some(c=>w.includes(c)))return!0}return!1},Z=()=>{let e=0,i;const a=b(),s=async r=>{var m;if((r.ctrlKey||r.metaKey)&&r.key==="x"&&(e+=1,i&&clearTimeout(i),i=setTimeout(()=>{e=0},1e3),e===2)){const t=await S();if(e=0,!(((m=t.keyboardShortcut)==null?void 0:m.shortcut_summary)??!1))return;await v({media:a,actionVia:"closed_widget",userConfig:t})}};return{initialize:()=>{window.addEventListener("keydown",s)},cleanup:()=>{window.removeEventListener("keydown",s),i&&clearTimeout(i)}}},ee=async()=>{Z().initialize()},te=()=>{const e=async()=>{const i=b(),a=await S();await v({media:i,userConfig:a})};return o.jsx("div",{className:"flex justify-center items-center w-[32px] h-[32px] p-1 rounded-full cursor-pointer bg-transparent outline-none relative hover:bg-white hover:bg-opacity-5",onClick:e,children:o.jsx(U,{size:18})})},oe=()=>{const e=k();e.style.position="fixed",e.style.top="12px",e.style.right="124px",e.style.zIndex="9999",e.style.userSelect="none",document.body.insertAdjacentElement("afterend",e),M.createRoot(e).render(o.jsx(C.StrictMode,{children:o.jsx(E,{children:o.jsx(L,{children:o.jsx(j,{children:Y()?o.jsx(P,{forceShow:!0}):o.jsx(te,{})})})})}))};try{(async()=>{if(B()||G())return!1;N(),ee(),K.includes(window.location.hostname)||V(),H()&&oe()})()}catch{}
